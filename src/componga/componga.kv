#:kivy 2.2.1
#:import os os
#:import sp kivy.metrics.sp

<ShapeViewport>: 
    pos_hint: {'center_x': .5, 'center_y': .5} 
    size_hint: (.25, .2)
    canvas.before:
        Color:
            rgba: 0, 0, 0, .30
        BoxShadow:
            pos: self.pos
            size: self.size
            offset: -10, -10
            blur_radius: 50
            spread_radius: 10, 10
            border_radius: 50, 50, 50, 50
    canvas:
        Color:
            rgba: (1, 1, 1, .5)            
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: 50, 50, 50, 50
    FloatLayout:
        id: content
        pos_hint: {'center_x': .5, 'center_y': .5} 
        size_hint: (.75, .75)
        shape: root.shape
        on_shape: self.clear_widgets(); self.shape.pos_hint={'center_x': .5, 'center_y': .5}; self.add_widget(self.shape)
    
<-ColorWheelPicker>:
    foreground_color: (1, 1, 1, 1) if self.hsv[2] * root.color[3] < .5 else (0, 0, 0, 1)
    wheel: wheel
    BoxLayout:
        orientation: 'vertical'
        canvas:
            Color:
                rgba: root.color
            Rectangle:
                size: self.size
                pos: self.pos
        ColorWheel:
            id: wheel
            color: root.color
            on_color: root.set_color(args[1][:3])

<PopupHelp>:
    title: 'Help'
    title_align: 'center'
    size_hint: .5, .5
    BoxLayout:
        id: content
        orientation: 'vertical'
        padding: 10
        spacing: 10
        ScrollView:
            id: scroll
            bar_width: 10
            scroll_type: ['bars', 'content']
            BoxLayout:
                id: scroll_content
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
        
<PopupMenu>:
    title: 'Menu'
    title_align: 'center'
    content: content
    size_hint: None, None
    size: 200, 700
    pos_hint: {'right': 1, 'y': 0.25}
    overlay_color: 0, 0, 0, 0
    canvas.before:
        Color:
            rgba: 0, 0, 0, 0.30
        BoxShadow:
            pos: self.pos
            size: self.size
            offset: -10, -10
            blur_radius: 50
            spread_radius: 10, 10
            border_radius: 50, 50, 50, 50
    BoxLayout:
        id: content
        orientation: 'vertical'
        ColorWheel:
            id: clr_picker
            color: root.shape_color
            on_color: root.shape_color = args[1]
        Slider:
            id: slider
            min: root.min_line_width
            max: root.max_line_width
            value: root.line_width
            step: 1
            orientation: 'horizontal'
            value_track: True
            value_track_color: (1, 0, 0, 1)
            on_value: root.line_width = slider.value
        Button:
            text: 'Blip'
            on_release: root.shape_type = 'Blip'
        Button:
            text: 'Arrow Straight'
            on_release: root.shape_type = 'ArrowStraight'
        Button:
            text: 'Arrow Path'
            on_release: root.shape_type = 'ArrowPath'
        Button:
            text: 'Line Straight'
            on_release: root.shape_type = 'LineStraight'
        Button:
            text: 'Line Path'
            on_release: root.shape_type = 'Path'
        Button:
            text: 'Rectangle'
            on_release: root.shape_type = 'Rectangle'
        Button:
            text: 'Ellipse'
            on_release: root.shape_type = 'Ellipse'
        Button:
            text: 'Help'
            background_color: .5, 1, .5, 1
            on_release: root.show_help = True
